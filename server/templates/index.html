{% extends "base.html" %} {% block title %}Cataloger - Home{% endblock %} {%
block content %}
<div class="hero">
  <h2>Cataloger</h2>
  <p>Keep an AI on data quality</p>
</div>

<div class="card">
  <h3>Recently Updated Catalogs</h3>
  <div
    hx-get="/api/catalog/recent?limit=5"
    hx-trigger="load"
    hx-swap="innerHTML"
  >
    <p class="loading">Loading recent catalogs...</p>
  </div>
</div>

<div class="card">
  <h3>View Catalog History</h3>
  <form action="/database/timelapse" method="get">
    <div class="form-group">
      <label for="prefix">Database Prefix:</label>
      <input
        type="text"
        id="prefix"
        name="prefix"
        placeholder="e.g., customer-123/orders"
        required
      />
      <small>Format: customer-id/database-name</small>
    </div>
    <button type="submit" class="button-full">View Catalog History</button>
  </form>
</div>

<div class="card">
  <h3>About</h3>
  <p>
    Cataloger uses LLM agents to explore databases and generate comprehensive
	catalogs. The autonomous agents inspect tables of your choosing and run
	analytical queries to produce a qualitative summary of the current
	data. Then, agents analyze the changes in these summaries over time
	and can alert on anomolous reports.
  </p>
  <ul>
    <li>
      <strong>Schema Analysis</strong> - Table structures, column types,
      nullability
    </li>
    <li>
      <strong>Data Profiling</strong> - Row counts, null rates, distributions
    </li>
    <li><strong>Temporal Trends</strong> - Changes over time, anomalies</li>
    <li>
      <strong>Executable Scripts</strong> - Visibility into the code that generated each
      catalog
    </li>
  </ul>
</div>

<div class="card">
  <h3>Authentication Token</h3>
  <p>Set your authentication token to enable commenting on catalogs:</p>
  <div class="form-group">
    <label for="authToken">Auth Token:</label>
    <input
      type="text"
      id="authToken"
      placeholder="Paste your JWT token here"
    />
    <small>Generate a token using: <code>uv run cataloger generate-token your-secret</code></small>
  </div>
  <button class="button" onclick="setAuthToken()">Save Token</button>
  <button class="button secondary" onclick="clearAuthToken()">Clear Token</button>
  <p id="tokenStatus" style="margin-top: 1rem; color: var(--text-muted);"></p>
</div>

<div class="card">
  <h3>Quick Links</h3>
  <div class="link-grid">
    <a href="/docs" class="link-card">API Docs</a>
    <a href="/healthz" class="link-card">Health Check</a>
    <a href="/metrics" class="link-card">Metrics</a>
  </div>
</div>

<script>
  // Load saved token on page load
  window.addEventListener('DOMContentLoaded', () => {
    const savedToken = localStorage.getItem('cataloger_auth_token');
    if (savedToken) {
      document.getElementById('authToken').value = savedToken;
      document.getElementById('tokenStatus').textContent = '✓ Token is saved';
      document.getElementById('tokenStatus').style.color = 'var(--success)';
    }
  });

  function setAuthToken() {
    const token = document.getElementById('authToken').value.trim();
    if (token) {
      localStorage.setItem('cataloger_auth_token', token);
      document.getElementById('tokenStatus').textContent = '✓ Token saved successfully';
      document.getElementById('tokenStatus').style.color = 'var(--success)';
    } else {
      document.getElementById('tokenStatus').textContent = '✗ Please enter a token';
      document.getElementById('tokenStatus').style.color = '#c33';
    }
  }

  function clearAuthToken() {
    localStorage.removeItem('cataloger_auth_token');
    document.getElementById('authToken').value = '';
    document.getElementById('tokenStatus').textContent = 'Token cleared';
    document.getElementById('tokenStatus').style.color = 'var(--text-muted)';
  }
</script>

{% endblock %}
