# Development Scripts

Bash scripts for running various Cataloger development processes.

## Setup Scripts

### setup-env.sh

Set up environment files and encode prompts.

```bash
./scripts/setup-env.sh
```

**What it does:**
- Creates `.env.server` from example if not exists
- Encodes agent prompts to base64
- Updates `.env.server` with encoded prompts

**After running:**
- Edit `.env.server` and set:
  - `ANTHROPIC_API_KEY`
  - `S3_BUCKET` and AWS credentials
  - `AUTH_SECRET`

### bootstrap-db.sh

Create sample databases for testing.

```bash
./scripts/bootstrap-db.sh
```

**What it does:**
- Runs `create_sample_db.py` → creates `data/sample_ecommerce.duckdb`
- Runs `create_timeseries_db.py` → creates `data/sample_timeseries.duckdb`

**Output:**
- E-commerce DB: 1,000 users, 200 products, 3,000 orders
- Time-series DB: 90 days of metrics with anomalies

### build-container.sh

Build the agent Docker container.

```bash
./scripts/build-container.sh
```

**What it does:**
- Builds `cataloger-agent:latest` from `Dockerfile.agent`
- Includes Python, ibis, boto3, database drivers

## Server Scripts

### run-server.sh

Start the Cataloger API server.

```bash
./scripts/run-server.sh
```

**What it does:**
- Sources `.env.server`
- Starts FastAPI server with uvicorn
- Enables auto-reload for development

**Endpoints:**
- API: `http://localhost:8000`
- UI: `http://localhost:8000/`
- Docs: `http://localhost:8000/docs`

## Catalog Generation Scripts

### catalog-ecommerce.sh

Generate catalog for e-commerce database.

```bash
./scripts/catalog-ecommerce.sh
```

**What it does:**
- Catalogs: `users`, `products`, `orders`, `order_items`
- S3 prefix: `test/ecommerce`
- Opens view URL when done

**Requirements:**
- Database exists: `data/sample_ecommerce.duckdb`
- Server running
- Auth configured

### catalog-timeseries.sh

Generate catalog for time-series database.

```bash
./scripts/catalog-timeseries.sh
```

**What it does:**
- Catalogs: `daily_metrics`, `system_events`
- S3 prefix: `test/timeseries`
- Opens view URL when done

**Requirements:**
- Database exists: `data/sample_timeseries.duckdb`
- Server running
- Auth configured

## Complete Workflow

Full setup from scratch:

```bash
# 1. Setup environment
./scripts/setup-env.sh
# Edit .env.server with your API keys

# 2. Build container
./scripts/build-container.sh

# 3. Create sample databases
./scripts/bootstrap-db.sh

# 4. Start server (in separate terminal)
./scripts/run-server.sh

# 5. Generate catalogs
./scripts/catalog-ecommerce.sh
./scripts/catalog-timeseries.sh

# 6. View in browser
open http://localhost:8000
```

## Script Permissions

Make scripts executable:

```bash
chmod +x scripts/*.sh
```

## Environment Variables

Scripts use environment variables from `.env.server`:

```bash
# Server config
HOST=0.0.0.0
PORT=8000

# API keys
ANTHROPIC_API_KEY=sk-ant-...
AUTH_SECRET=your-secret

# S3
S3_BUCKET=your-bucket
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...

# Container
CONTAINER_IMAGE=cataloger-agent:latest
CONTAINER_POOL_SIZE=5

# Prompts (auto-generated by setup-env.sh)
CATALOGING_AGENT_PROMPT=<base64>
SUMMARY_AGENT_PROMPT=<base64>
```

## Makefile Integration

These scripts complement the Makefile:

```bash
# Via Makefile
make run-server          # Same as ./scripts/run-server.sh
make build-container     # Same as ./scripts/build-container.sh

# Via scripts
./scripts/setup-env.sh         # Not in Makefile
./scripts/bootstrap-db.sh      # Not in Makefile
./scripts/catalog-ecommerce.sh # Not in Makefile
```

Use Makefile for common tasks, scripts for workflows.

## Troubleshooting

### Script not executable

```bash
bash: permission denied: ./scripts/run-server.sh
```

**Fix:**
```bash
chmod +x scripts/*.sh
```

### Environment not loaded

```bash
Error: Missing ANTHROPIC_API_KEY
```

**Fix:**
```bash
# Check .env.server exists and has correct values
cat .env.server

# Re-run setup
./scripts/setup-env.sh
```

### Database not found

```bash
Error: Database not found at data/sample_ecommerce.duckdb
```

**Fix:**
```bash
./scripts/bootstrap-db.sh
```

### Container not built

```bash
RuntimeError: Container image 'cataloger-agent:latest' not found
```

**Fix:**
```bash
./scripts/build-container.sh
```

## Adding New Scripts

Template for new scripts:

```bash
#!/usr/bin/env bash
# Description of what this script does

set -e  # Exit on error

echo "Starting task..."

# Your commands here

echo "Task complete!"
```

Save in `scripts/`, make executable:

```bash
chmod +x scripts/my-script.sh
```
