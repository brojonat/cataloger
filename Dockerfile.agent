FROM python:3.13-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    libpq-dev \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Create working directory
WORKDIR /workspace

# Install Python packages
RUN pip install --no-cache-dir \
    ibis-framework[postgres,mysql,duckdb]==9.5.0 \
    boto3==1.35.0 \
    polars==1.13.0 \
    pandas==2.2.0 \
    pyarrow==18.1.0

# Create a user for running code (security)
RUN useradd -m -u 1000 agent && chown -R agent:agent /workspace
USER agent

# Keep container running, listening for execution requests
CMD ["python", "-u", "-c", "import time; time.sleep(float('inf'))"]
